<pre class="code">
<span class="srcline"><span class="lineno"><a href="64,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T18U3">mfout</span> = <span class="message warning" id="M3F195C">mf_coder</span>(<span class="var type1" id="S3T3U6">rx</span>, <span class="var type1" id="S4T1U7">tauhat</span>, <span class="var type1" id="S5T1U8">rolloff</span>, <span class="var type1" id="S6T1U9">q</span>,<span class="var type1" id="S7T1U10">T</span>,<span class="var type1" id="S8T27U11">P</span>,<span class="var type1" id="S9T28U12">D</span>,<span class="var type1" id="S10T1U13">RrcNsym</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="64,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%Run a matched filter on the received samples, returns recieved</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%symbols.</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%    </span></span></span>
<span class="srcline"><span class="lineno"><a href="64,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%    mfout = mf(rx, tauhat, acqparams)</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% INPUTS:</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%   rx              - sampled received signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%   tauhat        - time offset estimate</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,10" id="srcline10">10</a></span><span class="line"><span class="comment">%   acqparam        - struct holding aquisition parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,11" id="srcline11">11</a></span><span class="line"><span class="comment">%       .T              - symbol period</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,12" id="srcline12">12</a></span><span class="line"><span class="comment">%       .L              - number of symbols (assumed consequtive)</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,13" id="srcline13">13</a></span><span class="line"><span class="comment">%       .OS             - oversampling factor</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,14" id="srcline14">14</a></span><span class="line"><span class="comment">%       .pshape         - function representing transmission pulse shape</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,15" id="srcline15">15</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,16" id="srcline16">16</a></span><span class="line"><span class="comment">% OUTPUTS:</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,17" id="srcline17">17</a></span><span class="line"><span class="comment">%   mfout        - matched filtered signal at symbol rate</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,18" id="srcline18">18</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,19" id="srcline19">19</a></span><span class="line"><span class="comment">% (c) 2012 ITR-UniSA</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,20" id="srcline20">20</a></span><span class="line"><span class="comment">% Authors: Robby McKilliam</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,21" id="srcline21">21</a></span><span class="line"><span class="comment">% Created: 4 April 2012</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,22" id="srcline22">22</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,23" id="srcline23">23</a></span><span class="line">    <span class="comment">%g = acqparam.pshape;</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,24" id="srcline24">24</a></span><span class="line">    <span class="mxinfo" id="T1:U10"><span class="var type1" id="S11T1U16">p</span> = <span class="mxinfo" id="T1:U12">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,25" id="srcline25">25</a></span><span class="line">    <span class="comment">%q = acqparam.OS;</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,26" id="srcline26">26</a></span><span class="line">    <span class="comment">%T = acqparam.T;</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,27" id="srcline27">27</a></span><span class="line">    <span class="mxinfo" id="T1:U13"><span class="var type1" id="S12T1U20">Ts</span> = <span class="mxinfo" id="T1:U15"><span class="mxinfo" id="T1:U16"><span class="mxinfo" id="T1:U17"><span class="var type1" id="S11T1U23">p</span></span>*<span class="var type1" id="S7T1U24">T</span></span>/<span class="var type1" id="S6T1U25">q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo" id="T1:U21"><span class="var type1" id="S13T1U28">mini</span> = <span class="mxinfo" id="T1:U23">min(<span class="mxinfo" id="T1:U24">min(<span class="var type1" id="S8T27U33">P</span>)</span>,<span class="mxinfo" id="T1:U26">min(<span class="var type1" id="S9T28U36">D</span>)</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="64,29" id="srcline29">29</a></span><span class="line">    <span class="mxinfo" id="T1:U28"><span class="var type1" id="S15T1U39">maxi</span> = <span class="mxinfo" id="T1:U30">max(<span class="mxinfo" id="T1:U31">max(<span class="var type1" id="S8T27U44">P</span>)</span>,<span class="mxinfo" id="T1:U33">max(<span class="var type1" id="S9T28U47">D</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo" id="T1:U35"><span class="var type1" id="S17T1U50">N</span> = <span class="mxinfo" id="T1:U37">length(<span class="var type1" id="S3T3U53">rx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo" id="T1:U39"><span class="var type1" id="S19T1U56">L</span> = <span class="var type1" id="S15T1U57">maxi</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,32" id="srcline32">32</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo" id="T26:U42"><span class="var type1" id="S20T26U60">ns</span> = <span class="mxinfo" id="T26:U44"><span class="mxinfo" id="T26:U45"><span class="mxinfo" id="T26:U46"><span class="mxinfo" id="T26:U47">(<span class="mxinfo" id="T26:U48"><span class="mxinfo" id="T1:U49"><span class="mxinfo" id="T1:U50"><span class="mxinfo" id="T1:U51"><span class="mxinfo" id="T1:U52"><span class="var type1" id="S11T1U70">p</span></span>*<span class="var type1" id="S6T1U71">q</span></span>*<span class="var type1" id="S13T1U72">mini</span></span> - <span class="mxinfo" id="T1:U56"><span class="mxinfo" id="T1:U57"><span class="var type1" id="S11T1U74">p</span></span>*<span class="mxinfo" id="T1:U59"><span class="var type1" id="S17T1U75">N</span></span></span></span> : <span class="mxinfo" id="T1:U61"><span class="mxinfo" id="T1:U62"><span class="mxinfo" id="T1:U63"><span class="mxinfo" id="T1:U64"><span class="var type1" id="S11T1U79">p</span></span>*<span class="var type1" id="S6T1U80">q</span></span>*<span class="var type1" id="S15T1U81">maxi</span></span> - <span class="var type1" id="S11T1U82">p</span></span></span>)*(-1)</span>*<span class="var type1" id="S12T1U86">Ts</span></span>/<span class="mxinfo" id="T1:U70"><span class="var type1" id="S11T1U87">p</span></span></span> - <span class="var type1" id="S4T1U88">tauhat</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,34" id="srcline34">34</a></span><span class="line">    <span class="comment">%lvec = conj( g(-ns*Ts/p - tauhat) );</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo" id="T26:U73"><span class="var type1" id="S21T26U91">lvec</span> = conj( <span class="mxinfo" id="T26:U75"><span class="mxinfo" id="T26:U76"><span class="fcn" id="F267N7:B96">rrcpulse</span>(<span class="var type1" id="S20T26U97">ns</span>,<span class="var type1" id="S5T1U98">rolloff</span>,<span class="var type1" id="S7T1U99">T</span>,<span class="var type1" id="S6T1U100">q</span>)</span> .*<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="64,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo" id="T26:U73"><span class="mxinfo" id="T26:U75">    (<span class="mxinfo" id="T29:U81"><span class="mxinfo" id="T26:U82">abs(<span class="var type1" id="S20T26U105">ns</span>)</span> &lt;= <span class="mxinfo" id="T1:U84"><span class="mxinfo" id="T1:U85"><span class="var type1" id="S10T1U108">RrcNsym</span>*<span class="var type1" id="S6T1U109">q</span></span>*<span class="var type1" id="S12T1U110">Ts</span></span></span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo" id="T3:U89"><span class="var type1" id="S25T3U113">zvec</span> = <span class="mxinfo" id="T3:U91"><span class="mxinfo" id="T17:U92">zeros(<span class="mxinfo" id="T1:U93">1</span>,<span class="mxinfo" id="T1:U94"><span class="var type1" id="S11T1U121">p</span>*<span class="var type1" id="S17T1U122">N</span> - <span class="var type1" id="S11T1U123">p</span> + 1</span>)</span> + <span class="mxinfo" id="T3:U98">1j*zeros(1,<span class="var type1" id="S11T1U133">p</span>*<span class="var type1" id="S17T1U134">N</span> - <span class="var type1" id="S11T1U135">p</span> + 1)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="64,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo" id="T3:U102"><span class="mxinfo" id="T3:U103"><span class="var type1" id="S25T3U140">zvec</span>(<span class="mxinfo" id="T53:U105"><span class="mxinfo" id="T1:U106">1</span>:<span class="mxinfo" id="T1:U107"><span class="var type1" id="S11T1U144">p</span></span>:<span class="mxinfo" id="T1:U109"><span class="var type1" id="S11T1U148">p</span>*<span class="var type1" id="S17T1U149">N</span>-<span class="var type1" id="S11T1U150">p</span>+1</span></span>)</span> = <span class="var type1" id="S3T3U152">rx</span></span>; <span class="comment">%zerofilled r</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo" id="T18:U114"><span class="var type1" id="S27T18U155">h</span> = <span class="mxinfo" id="T18:U116"><span class="fcn" id="F299N3:B157">conv_fft</span>(<span class="var type1" id="S21T26U158">lvec</span>, <span class="var type1" id="S25T3U159">zvec</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,41" id="srcline41">41</a></span><span class="line">    <span class="comment">%plot(real(h));</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,42" id="srcline42">42</a></span><span class="line">    <span class="comment">%length(h)</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,43" id="srcline43">43</a></span><span class="line">    <span class="comment">%length(q*(mini:maxi))</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,44" id="srcline44">44</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo" id="T18:U119"><span class="var type1" id="S2T18U162">mfout</span> = <span class="mxinfo" id="T18:U121"><span class="mxinfo" id="T18:U122"><span class="var type1" id="S27T18U165">h</span>(<span class="mxinfo" id="T26:U124"><span class="mxinfo" id="T26:U125"><span class="mxinfo" id="T26:U126"><span class="var type1" id="S6T1U169">q</span>*(<span class="mxinfo" id="T26:U128"><span class="var type1" id="S13T1U172">mini</span>:<span class="var type1" id="S15T1U173">maxi</span></span>)</span> - <span class="mxinfo" id="T1:U131"><span class="var type1" id="S6T1U175">q</span>*<span class="var type1" id="S13T1U176">mini</span></span></span> + <span class="mxinfo" id="T1:U134">1</span></span>)</span>*<span class="var type1" id="S12T1U178">Ts</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,46" id="srcline46">46</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,47" id="srcline47">47</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
