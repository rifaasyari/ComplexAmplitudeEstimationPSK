<pre class="code">
<span class="srcline"><span class="lineno"><a href="16,1" id="srcline1">  1</a></span><span class="line"><span class="comment">% Frequency estimation from periodogram.</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%-------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% freqest_periodogram.m </span></span></span>
<span class="srcline"><span class="lineno"><a href="16,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% [fhat] = freqest_periodogram(RxSamp,tSamp,AcqParams)</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% This function etimates the frequency of a noisy complex exponential by</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% maximising the periodogram. First, a coarse estimate is obtained by</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% computing the periodogram at the discrete frequencies of an FFT. This</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">% coarse estimate then serves as the initialisation for the second</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% estimator stage, which climbs the objective function using Newton's</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% method. As proposed by Quinn et al. [1], Newton's method is applied to</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">% the logarithm of the periodogram rather than the periodogram itself. This</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% approach eliminates the need for zero padding to increase the resolution</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% of the FFT-based initial estimate.</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%   [1] B. Quinn et al., "Maximizing the Periodogram", in Proc. IEEE Global</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%       Global Telecommunications Conference, Nov. 2008 </span></span></span>
<span class="srcline"><span class="lineno"><a href="16,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="16,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">% Inputs:</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%   RxSamp      - Vector containing samples of received signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%   tSamp       - Vector of sample times in seconds</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%   AcqParams   - Struct holding aquisition parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%       .T          - symbol period</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%       .OS         - oversampling factor</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%       .Lsin       - duration of the sinusoid in symbol periods</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%       .taumin         - minimum time offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%       .taumax         - maximum time offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">% Outputs:</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%  fhat         - Frequency estimate [Hz]</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">% Comments:</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="16,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%-------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">% Author: A. Pollok, Institute for Telecommunications Research</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">% Project: ASRP</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%-------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">% Copyright 2012 </span></span></span>
<span class="srcline"><span class="lineno"><a href="16,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">% Institute for Telecommunications Research</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% University of South Australia</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%-------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,43" id="srcline43"> 43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="16,44" id="srcline44"> 44</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">fhat</span>,<span class="var type1" id="S3T1U4">phihat</span>] = <span class="message warning" id="M2F42C">freqest_periodogram_coder</span>(<span class="var type1" id="S4T3U7">RxSamp</span>,<span class="var type1" id="S5T17U8">tSamp</span>,<span class="var type1" id="S6T1U9">T</span>,<span class="var type1" id="S7T1U10">OS</span>,<span class="var type1" id="S8T1U11">Lsin</span>,<span class="var type1" id="S9T1U12">taumin</span>,<span class="var type1" id="S10T1U13">taumax</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="16,45" id="srcline45"> 45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="16,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%% system parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%T = AcqParams.T; % symbol period</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%OS = AcqParams.OS; % oversampling factor</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,49" id="srcline49"> 49</a></span><span class="line"><span class="mxinfo" id="T1:U10"><span class="var type1" id="S11T1U16">Ts</span> = <span class="mxinfo" id="T1:U12"><span class="var type1" id="S6T1U18">T</span>/<span class="var type1" id="S7T1U19">OS</span></span></span>; <span class="comment">% sample period</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%Lsin = AcqParams.Lsin; % duration of the sinusoid in symbol periods</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,51" id="srcline51"> 51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="16,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">% channel parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%taumin = AcqParams.taumin;</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%taumax = AcqParams.taumax;</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="16,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% discard samples before minimum time delay</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo" id="T1:U15"><span class="var type1" id="S12T1U22">idxStart</span> = <span class="mxinfo" id="T1:U17"><span class="mxinfo" id="T1:U18">floor(<span class="mxinfo" id="T1:U19"><span class="var type1" id="S9T1U27">taumin</span>/<span class="var type1" id="S11T1U28">Ts</span></span>)</span>+<span class="mxinfo" id="T1:U22">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo" id="T1:U23"><span class="var type1" id="S14T1U32">idxEnd</span>   = <span class="mxinfo" id="T1:U25"><span class="mxinfo" id="T1:U26"><span class="mxinfo" id="T1:U27"><span class="var type1" id="S12T1U36">idxStart</span>-<span class="mxinfo" id="T1:U29">1</span></span> + <span class="mxinfo" id="T1:U30">ceil(<span class="mxinfo" id="T1:U31">(<span class="mxinfo" id="T1:U32"><span class="var type1" id="S10T1U43">taumax</span>-<span class="var type1" id="S9T1U44">taumin</span></span>)/<span class="var type1" id="S11T1U45">Ts</span></span>)</span></span> + <span class="mxinfo" id="T1:U36"><span class="var type1" id="S8T1U47">Lsin</span>*<span class="var type1" id="S7T1U48">OS</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,59" id="srcline59"> 59</a></span><span class="line"><span class="mxinfo" id="T18:U39"><span class="var type1" id="S4T18U51">RxSamp</span> = <span class="mxinfo" id="T18:U41"><span class="var type1" id="S4T3U53">RxSamp</span>(<span class="var type1" id="S12T1U55">idxStart</span>:<span class="var type1" id="S14T1U56">idxEnd</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo" id="T26:U45"><span class="var type1" id="S5T26U59">tSamp</span>  =  <span class="mxinfo" id="T26:U47"><span class="var type1" id="S5T17U61">tSamp</span>(<span class="var type1" id="S12T1U63">idxStart</span>:<span class="var type1" id="S14T1U64">idxEnd</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="16,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo" id="T1:U51"><span class="var type1" id="S16T1U67">N</span> = <span class="mxinfo" id="T1:U53">length(<span class="var type1" id="S4T18U70">RxSamp</span>)</span></span>; <span class="comment">% number of samples</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,63" id="srcline63"> 63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="16,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%% coarse frequency estimation via periodogram</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo" id="T1:U55"><span class="var type1" id="S18T1U73">pad</span> = <span class="mxinfo" id="T1:U57">1</span></span>; <span class="comment">% zero-padding factor for FFT</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo" id="T1:U58"><span class="var type1" id="S19T1U77">Nfft</span> = <span class="mxinfo" id="T1:U60"><span class="mxinfo" id="T1:U61">2</span>^<span class="mxinfo" id="T1:U62">nextpow2(<span class="mxinfo" id="T1:U63"><span class="mxinfo" id="T1:U64"><span class="var type1" id="S18T1U83">pad</span></span>*<span class="var type1" id="S16T1U84">N</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">% compute periodogram</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,68" id="srcline68"> 68</a></span><span class="line"><span class="mxinfo" id="T18:U67"><span class="var type1" id="S21T18U87">I</span> = <span class="mxinfo" id="T18:U69">fft(<span class="var type1" id="S4T18U90">RxSamp</span>,<span class="var type1" id="S19T1U91">Nfft</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,69" id="srcline69"> 69</a></span><span class="line"><span class="mxinfo" id="T1:U72">[<span class="mxinfo" id="T1:U73">~</span>,<span class="var type1" id="S23T1U96">idxmax</span>] = max(<span class="mxinfo" id="T26:U75"><span class="mxinfo" id="T26:U76">abs(<span class="var type1" id="S21T18U102">I</span>)</span>.^2</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,70" id="srcline70"> 70</a></span><span class="line"><span class="mxinfo" id="T1:U78"><span class="var type1" id="S26T1U106">fhatcoarse</span> = <span class="mxinfo" id="T1:U80"><span class="mxinfo" id="T1:U81">(<span class="mxinfo" id="T1:U82"><span class="var type1" id="S23T1U111">idxmax</span>-<span class="mxinfo" id="T1:U84">1</span></span>)/<span class="var type1" id="S19T1U113">Nfft</span></span>/<span class="var type1" id="S11T1U114">Ts</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,71" id="srcline71"> 71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="16,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%% refine estimate via Newton's method</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,73" id="srcline73"> 73</a></span><span class="line"><span class="mxinfo" id="T1:U87"><span class="var type1" id="S27T1U117">alpha</span> = <span class="mxinfo" id="T1:U89">0</span></span>; <span class="comment">% alpha=0: max log(periodogram), alpha=1: max standard periodogram</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,74" id="srcline74"> 74</a></span><span class="line"><span class="mxinfo" id="T1:U90"><span class="var type1" id="S28T1U121">gamma</span> = <span class="mxinfo" id="T1:U92">Inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,75" id="srcline75"> 75</a></span><span class="line"><span class="mxinfo" id="T1:U93"><span class="var type1" id="S30T1U126">EPSILON</span> = <span class="mxinfo" id="T1:U95">1e-10</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo" id="T1:U96"><span class="var type1" id="S31T1U130">MAX_ITER</span> = <span class="mxinfo" id="T1:U98">15</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo" id="T1:U99"><span class="var type1" id="S32T1U134">numIter</span> = <span class="mxinfo" id="T1:U101">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo" id="T1:U102"><span class="var type1" id="S2T1U138">fhat</span> = <span class="var type1" id="S26T1U139">fhatcoarse</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,79" id="srcline79"> 79</a></span><span class="line"><span class="mxinfo" id="T13:U105"><span class="var type1" id="S33T13U142">Y</span>=<span class="mxinfo" id="T1:U107">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,80" id="srcline80"> 80</a></span><span class="line"><span class="keyword">while</span> ((<span class="mxinfo" id="T9:U108"><span class="mxinfo" id="T1:U109">abs(<span class="var type1" id="S28T1U151">gamma</span>)</span> &gt; <span class="var type1" id="S30T1U152">EPSILON</span></span>) &amp;&amp; (<span class="mxinfo" id="T9:U112"><span class="var type1" id="S32T1U155">numIter</span> &lt; <span class="var type1" id="S31T1U156">MAX_ITER</span></span>))</span></span>
<span class="srcline"><span class="lineno"><a href="16,81" id="srcline81"> 81</a></span><span class="line">    <span class="comment">% evaluate periodogram I and its first two derivatives Idd and Idd</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,82" id="srcline82"> 82</a></span><span class="line">    <span class="mxinfo" id="T18:U115"><span class="var type1" id="S34T18U159">X</span> = <span class="mxinfo" id="T18:U117"><span class="var type1" id="S4T18U161">RxSamp</span>.*<span class="mxinfo" id="T18:U119">exp(<span class="mxinfo" id="T18:U120"><span class="mxinfo" id="T13:U121"><span class="mxinfo" id="T13:U122">-2i*pi</span>*<span class="var type1" id="S2T1U171">fhat</span></span>*<span class="var type1" id="S5T26U172">tSamp</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,83" id="srcline83"> 83</a></span><span class="line">    <span class="mxinfo" id="T13:U125"><span class="var type1" id="S33T13U175">Y</span> = <span class="mxinfo" id="T13:U127"><span class="mxinfo" id="T1:U128"><span class="mxinfo" id="T1:U129">1</span>/<span class="var type1" id="S16T1U179">N</span></span>*<span class="mxinfo" id="T13:U131">sum(<span class="var type1" id="S34T18U182">X</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,84" id="srcline84"> 84</a></span><span class="line">    <span class="mxinfo" id="T13:U133"><span class="var type1" id="S38T13U185">Yd</span> =  <span class="mxinfo" id="T13:U135"><span class="mxinfo" id="T13:U136"><span class="mxinfo" id="T13:U137">-2i*pi</span>/<span class="var type1" id="S16T1U193">N</span></span>  * <span class="mxinfo" id="T13:U139">sum(<span class="mxinfo" id="T18:U140"><span class="var type1" id="S5T26U197">tSamp</span>   .*<span class="var type1" id="S34T18U198">X</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,85" id="srcline85"> 85</a></span><span class="line">    <span class="mxinfo" id="T13:U143"><span class="var type1" id="S39T13U201">Ydd</span> = <span class="mxinfo" id="T13:U145"><span class="mxinfo" id="T1:U146"><span class="mxinfo" id="T1:U147">-4*pi^2</span>/<span class="var type1" id="S16T1U211">N</span></span> * <span class="mxinfo" id="T13:U149">sum(<span class="mxinfo" id="T18:U150"><span class="mxinfo" id="T26:U151"><span class="var type1" id="S5T26U216">tSamp</span>.^2</span>.*<span class="var type1" id="S34T18U218">X</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,86" id="srcline86"> 86</a></span><span class="line">    <span class="mxinfo" id="T1:U154"><span class="var type1" id="S21T1U221">I</span> = <span class="mxinfo" id="T1:U156"><span class="mxinfo" id="T1:U157">abs(<span class="var type1" id="S33T13U225">Y</span>)</span>^<span class="mxinfo" id="T1:U159">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,87" id="srcline87"> 87</a></span><span class="line">    <span class="mxinfo" id="T1:U160"><span class="var type1" id="S40T1U229">Id</span> =  <span class="mxinfo" id="T1:U162"><span class="mxinfo" id="T1:U163">2</span>*<span class="mxinfo" id="T1:U164">real(<span class="mxinfo" id="T13:U165"><span class="var type1" id="S38T13U235">Yd</span>*<span class="mxinfo" id="T13:U167">conj(<span class="var type1" id="S33T13U238">Y</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,88" id="srcline88"> 88</a></span><span class="line">    <span class="mxinfo" id="T1:U169"><span class="var type1" id="S43T1U241">Idd</span> = <span class="mxinfo" id="T1:U171"><span class="mxinfo" id="T1:U172"><span class="mxinfo" id="T1:U173">2</span>*<span class="mxinfo" id="T1:U174">real(<span class="mxinfo" id="T13:U175"><span class="var type1" id="S39T13U248">Ydd</span>*<span class="mxinfo" id="T13:U177">conj(<span class="var type1" id="S33T13U251">Y</span>)</span></span>)</span></span> + <span class="mxinfo" id="T1:U179"><span class="mxinfo" id="T1:U180">2</span>*<span class="mxinfo" id="T1:U181"><span class="mxinfo" id="T1:U182">abs(<span class="var type1" id="S38T13U257">Yd</span>)</span>^<span class="mxinfo" id="T1:U184">2</span></span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,89" id="srcline89"> 89</a></span><span class="line">    <span class="comment">% Newton iterate</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,90" id="srcline90"> 90</a></span><span class="line">    <span class="mxinfo" id="T1:U185"><span class="var type1" id="S28T1U261">gamma</span> = <span class="mxinfo" id="T1:U187"><span class="var type1" id="S40T1U263">Id</span>/(<span class="mxinfo" id="T1:U189"><span class="var type1" id="S43T1U266">Idd</span> + <span class="mxinfo" id="T1:U191"><span class="mxinfo" id="T1:U192">(<span class="mxinfo" id="T1:U193"><span class="var type1" id="S27T1U271">alpha</span>-1</span>)*<span class="mxinfo" id="T1:U195"><span class="var type1" id="S40T1U274">Id</span>^<span class="mxinfo" id="T1:U197">2</span></span></span>/<span class="var type1" id="S21T1U276">I</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,91" id="srcline91"> 91</a></span><span class="line">    <span class="mxinfo" id="T1:U199"><span class="var type1" id="S2T1U279">fhat</span> = <span class="mxinfo" id="T1:U201"><span class="var type1" id="S2T1U281">fhat</span> - <span class="var type1" id="S28T1U282">gamma</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,92" id="srcline92"> 92</a></span><span class="line">    <span class="mxinfo" id="T1:U204"><span class="var type1" id="S32T1U285">numIter</span> = <span class="mxinfo" id="T1:U206"><span class="var type1" id="S32T1U287">numIter</span> + <span class="mxinfo" id="T1:U208">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,93" id="srcline93"> 93</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,94" id="srcline94"> 94</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="16,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">%% handle negative frequency offsets</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,96" id="srcline96"> 96</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo" id="T9:U209"><span class="var type1" id="S2T1U293">fhat</span> &gt; <span class="mxinfo" id="T1:U211"><span class="mxinfo" id="T1:U212">1</span>/(<span class="mxinfo" id="T1:U213"><span class="mxinfo" id="T1:U214">2</span>*<span class="var type1" id="S11T1U299">Ts</span></span>)</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="16,97" id="srcline97"> 97</a></span><span class="line">    <span class="comment">% negative frequency offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,98" id="srcline98"> 98</a></span><span class="line">    <span class="mxinfo" id="T1:U216"><span class="var type1" id="S2T1U302">fhat</span> = <span class="mxinfo" id="T1:U218"><span class="var type1" id="S2T1U304">fhat</span> - <span class="mxinfo" id="T1:U220"><span class="mxinfo" id="T1:U221">1</span>/<span class="var type1" id="S11T1U307">Ts</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,99" id="srcline99"> 99</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,100" id="srcline100">100</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="16,101" id="srcline101">101</a></span><span class="line"><span class="comment">%% estimate complex amplitude (least squares estimator)</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,102" id="srcline102">102</a></span><span class="line"><span class="comment">% amplsin = acqparams.amplsin;</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,103" id="srcline103">103</a></span><span class="line"><span class="comment">% cgainhat = Y/amplsin;</span></span></span>
<span class="srcline"><span class="lineno"><a href="16,104" id="srcline104">104</a></span><span class="line"><span class="mxinfo" id="T1:U223"><span class="var type1" id="S3T1U310">phihat</span> = <span class="mxinfo" id="T1:U225">angle(<span class="var type1" id="S33T13U313">Y</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="16,105" id="srcline105">105</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="16,106" id="srcline106">106</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
